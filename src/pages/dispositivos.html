<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Dispositivos - EcoTrack</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
  <main class="container">
    <h1>Dispositivos cadastrados</h1>
    <table id="table">
      <thead><tr><th>ID</th><th>Nome</th><th>Potência (W)</th><th>Horas/dia</th><th>Ações</th></tr></thead>
      <tbody></tbody>
    </table>
    <p><a href="/">Voltar</a></p>
  </main>
<script>
async function load() {
  const res = await fetch('/api/devices');
  const data = await res.json();
  const tbody = document.querySelector('#table tbody');
  tbody.innerHTML = '';
  data.forEach(d => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${d.id}</td><td>${d.nome}</td><td>${d.potencia}</td><td>${d.horasUso}</td>
      <td><button data-id="${d.id}" class="del">Deletar</button></td>`;
    tbody.appendChild(tr);
  });
  document.querySelectorAll('.del').forEach(btn => {
    btn.addEventListener('click', async (e) => {
      const id = btn.getAttribute('data-id');
      await fetch('/api/devices/' + id, { method: 'DELETE' });
      load();
    });
  });
}
load();
</script>
</html>
